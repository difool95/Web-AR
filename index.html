<!DOCTYPE html>
<html>

<head>
<title>Maginat</title>
<meta charset="UTF-8">
<!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<link rel="shortcut icon" type="image/png" href="./Nav.png">
  <style>

    body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
    
    #loading2 {
  display: flex;
  justify-content: center;
  margin-top: 18%;
}
</style>
</head>

<!--<script src="https://cdn.jsdelivr.net/npm/aframe@1.0.4/dist/aframe.min.js"></script>-->
<!--<script src="https://cdn.jsdelivr.net/npm/ar.js@2.0.8/aframe/build/aframe-ar.min.js"></script>-->
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
<script src="./zappar/zappar-aframe.js"></script>
<body onload="run();">
  <div id ='loading2'>
  <img src = "./Loading.gif" style= "width:400px;" alt="Loading..." />
  </div>
    <a-scene>
        <!-- Ask user for camera permissions, display some text if permission is denied -->
        <a-entity zappar-permissions-ui id="permissions"></a-entity>
        <!-- Browser Compatibility -->
        <a-entity zappar-compatibility-ui id="compatibility"></a-entity>
        <a-assets>
            <a-asset-item id="target-file" src="abc.zpt"/>
        </a-assets>
        <!--  <a-entity camera> </a-entity>-->
        <a-entity camera zappar-camera></a-entity>
        <a-entity zappar-image="target: #target-file" id="image-group">
            <!-- PLACE 3D OBJECTS HERE TO TRACK FROM THE CENTER OF THE IMAGE -->
            <!--<a-box id="box" scale="0.5 0.5 0.5" position='0 0 0' material='opacity: 0.0; transparent: true'>></a-box>-->
            <a-box id="box" position="0 0 0.5"></a-box>
        </a-entity>
    </a-scene>
      <script type="text/javascript" src="./nunu.min.js"></script>

      <script type="text/javascript">   
       /* if(iOS()){
          var meta1 = document.createElement('meta');
      meta1.httpEquiv = "content-type";
      meta1.content = "text/html; charset=ISO-8859-1";
      document.head.appendChild(meta1);
    }
    else{
      var meta2 = document.createElement('meta');
      meta2.name = "viewport";
      meta2.content = "width=device-width, user-scalable=no";
      document.head.appendChild(meta2);
    }*/
    let url_str = window.location.href;
    let url = new URL(url_str);
    let search_params = url.searchParams;
    var id_maginat=search_params.get('id');
    var app;
    var container;
    // Initialize app
    function run() {
    var loading = document.getElementById("loading2");
    // Create app object
    app = new Nunu.App();
    // Onload enable the vr and fullscreen buttons
    //var loading = document.getElementById("loading2");
    var box = document.getElementById('box');
    //WHEN APP IS LOADED
    var onLoad = function() {
    document.body.removeChild(loading);
    let canvas = document.getElementById("canvass");
    canvas.setAttribute("hidden", "hidden");
    container = app.getContainer();
    box.object3D.children[0].add(container); 
    //container.rotation.set(new THREE.Vector3(1.6, 0, 0));
    container.rotateX(1.6);
    const myImageGroup = document.getElementById("image-group");
    let imageVisible = false;
    myImageGroup.addEventListener("zappar-visible", () => {
        // The image has appeared so show the group
        myImageGroup.setAttribute("visible", "true");
        imageVisible = true;
        box.object3D.visible = true;
    });
    myImageGroup.addEventListener("zappar-notvisible", () => {
        // The image has disappeared so hide the group after a short delay
        imageVisible = false;
        setTimeout(() => {
            if (imageVisible === false){
              myImageGroup.setAttribute("visible", "false");
              box.object3D.visible = false;
            }
        }, 500)
    });
    //toggleFullscreen();
            // Check if VR is available
          /*  if (app.vrAvailable()) {
                button = document.getElementById("vr");
                button.style.visibility = "visible";
            }*/
  
    //Check if AR is available
            if (app.arAvailable()) {
               // toggleAR();

               // button = document.getElementById("ArMode");
               // button.style.visibility = "visible";
                //document.body.removeChild(loading);
            }
        };
  
        // On progress callback
        var bar = document.getElementById("bar");
        var onProgress = function(event) {
            if (event.lengthComputable) {
                var progress = event.loaded / event.total * 100;
                bar.style.width = progress + "%";
            }
        };
        app.loadRunProgram("./file.nsp", onLoad, onProgress);
    }
        // Resize app (must be called every time the window is resized)
    function resize() {
        app.resize();
    }

    // Toggle fullscreen mode
    function toggleFullscreen() {
        app.toggleFullscreen(document.body);
    }

    // Toggle VR mode
    function toggleVR() {
        app.toggleVR();
    }

    // Toggle AR mode
    function toggleAR() {
        app.toggleAR();
    } 
 
function iOS() {
  return [
    'iPad Simulator',
    'iPhone Simulator',
    'iPod Simulator',
    'iPad',
    'iPhone',
    'iPod'
  ].includes(navigator.platform)
  // iPad on iOS 13 detection
  || (navigator.userAgent.includes("Mac") && "ontouchend" in document)
 }

 </script>

</body>

</html>
